/**
 * SidebarComponent
 * Collapsible navigation with icon-only mode on small screens.
 *
 * Usage:
 * <app-sidebar [collapsed]="collapsed()" (navigate)="onNavigate($event)"></app-sidebar>
 *
 * Signals:
 * - collapsed: writable signal<boolean> controlled by viewport service and user toggle.
 * - activeRoute: computed from Router events for highlight state.
 */
import { NgClass } from '@angular/common';
import {
  ChangeDetectionStrategy,
  Component,
  HostListener,
  inject,
  OnInit,
  signal,
} from '@angular/core';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';
import { RouterLink, RouterLinkActive } from '@angular/router';
import { TooltipModule } from 'primeng/tooltip';

interface NavItem {
  id: string;
  label: string;
  icon: 'grid' | 'alert' | 'cube' | 'asterisk' | 'wrench' | 'doc' | 'hash';
  route?: string;
}

@Component({
  selector: 'app-sidebar',
  imports: [NgClass, RouterLink, RouterLinkActive, TooltipModule],
  templateUrl: './sidebar.html',
  styleUrl: './sidebar.scss',
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class Sidebar implements OnInit {
  collapsed = signal<boolean>(false);
  MenuItems = signal<NavItem[]>([
    { id: 'grid', label: 'Lorem', icon: 'grid', route: '/grid' },
    { id: 'alert', label: 'Lorem', icon: 'alert', route: '/alert' },
    { id: 'cube', label: 'Lorem', icon: 'cube', route: '/cube' },
    { id: 'asterisk', label: 'Lorem', icon: 'asterisk', route: '/dashboard' }, // active
    { id: 'wrench', label: 'Lorem', icon: 'wrench', route: '/wrench' },
    { id: 'doc', label: 'Lorem', icon: 'doc', route: '/doc' },
    { id: 'hash', label: 'Lorem', icon: 'hash', route: '/hash' },
  ]);
  private readonly LG_BREAKPOINT = 1024; // Tailwind lg

  private sanitizer = inject(DomSanitizer);

  ngOnInit() {
    this.setCollapsedByViewport();
  }

  @HostListener('window:resize')
  onResize() {
    this.setCollapsedByViewport();
  }

  private setCollapsedByViewport() {
    const shouldCollapse = window.innerWidth < this.LG_BREAKPOINT;
    this.collapsed.set(shouldCollapse);
  }

  getIcon(name: string): SafeHtml {
    const rawSvg = this.icons[name] || '';
    return this.sanitizer.bypassSecurityTrustHtml(rawSvg);
  }

  toggleCollapse() {
    this.collapsed.update((v) => !v);
  }

  private icons: Record<string, string> = {
    grid: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M8.83333 0.5V5.5H15.5V0.5M8.83333 15.5H15.5V7.16667H8.83333M0.5 15.5H7.16667V10.5H0.5M0.5 8.83333H7.16667V0.5H0.5V8.83333Z" fill="#A3A9B6"/>
</svg>
`,
    alert: `<svg width="18" height="16" viewBox="0 0 18 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M17.0861 12.6816L10.5787 1.42086C9.87707 0.193047 8.12305 0.193047 7.40391 1.42086L0.914046 12.6816C0.21244 13.8919 1.08945 15.4179 2.49266 15.4179H15.4899C16.9107 15.4179 17.7877 13.8919 17.0861 12.6816ZM9.00006 4.22729C9.56135 4.22729 9.99985 4.68333 9.99985 5.22707V5.29724L9.66659 10.3137C9.64905 10.6645 9.35087 10.9452 9.00006 10.9452C8.64926 10.9452 8.35108 10.6645 8.33354 10.3137L8.00027 5.29724C7.96519 4.71841 8.42124 4.22729 9.00006 4.22729ZM9.00006 13.5937C8.42124 13.5937 7.94765 13.1201 7.94765 12.5413C7.94765 11.9625 8.42124 11.4889 9.00006 11.4889C9.57889 11.4889 10.0525 11.9625 10.0525 12.5413C10.0525 13.1201 9.57889 13.5937 9.00006 13.5937Z" fill="#A3A9B6"/>
</svg>
`,
    cube: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_2354_104)">
<path d="M6.80116 0.66626L0.998657 6.46693H9.20649L15.009 0.66626H6.80116Z" fill="#A3A9B6"/>
<path d="M9.5387 15.0069L15.3394 9.20625V0.998413L9.5387 6.79908V15.0069Z" fill="#A3A9B6"/>
<path d="M9.07319 6.93457H0.669189V15.3331H9.07319V6.93457Z" fill="#A3A9B6"/>
</g>
<defs>
<clipPath id="clip0_2354_104">
<rect width="14.6703" height="14.6667" fill="white" transform="translate(0.666504 0.666626)"/>
</clipPath>
</defs>
</svg>
`,
    asterisk: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="#00481D"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
<path d="M14.2501 0.741699L15.4251 1.9167L11.6751 5.6667H14.6667V7.33337H8.83341V1.50003H10.5001V4.4917L14.2501 0.741699ZM15.4251 14.4167L14.2501 15.5917L10.5001 11.8417V14.8334H8.83341V9.00003H14.6667V10.6667H11.6751L15.4251 14.4167ZM1.75007 0.741699L5.50007 4.4917V1.50003H7.16674V7.33337H1.33341V5.6667H4.32507L0.575073 1.9167L1.75007 0.741699ZM0.575073 14.4167L4.32507 10.6667H1.33341V9.00003H7.16674V14.8334H5.50007V11.8417L1.75007 15.5917L0.575073 14.4167Z" fill="black" fill-opacity="0.2"/>
</svg>
`,
    wrench: `<svg width="18" height="18" viewBox="0 0 18 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M16.8333 5.25004C17.5 5.91671 17.5 7.00004 16.8333 7.58337L14.5 9.91671L7.99996 3.41671L10.3333 1.08337C11 0.416707 12.0833 0.416707 12.6666 1.08337L14.1666 2.58337L16.6666 0.083374L17.8333 1.25004L15.3333 3.75004L16.8333 5.25004ZM12 10.0834L10.8333 8.91671L8.49996 11.25L6.74996 9.50004L9.08329 7.16671L7.91663 6.00004L5.58329 8.33337L4.33329 7.16671L1.99996 9.50004C1.33329 10.1667 1.33329 11.25 1.99996 11.8334L3.49996 13.3334L0.166626 16.6667L1.33329 17.8334L4.66663 14.5L6.16663 16C6.83329 16.6667 7.91663 16.6667 8.49996 16L10.8333 13.6667L9.66663 12.5L12 10.0834Z" fill="#A3A9B6"/>
</svg>
`,
    doc: `<svg width="12" height="17" viewBox="0 0 12 17" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M8.02858 2.61153V0.666626H1.56208C0.791226 0.666626 0.166626 1.29168 0.166626 2.06208V15.2304C0.166626 16.0013 0.791226 16.6259 1.56208 16.6259H9.88753C10.6584 16.6259 11.283 16.0008 11.283 15.2304V3.92103H9.33808C8.61583 3.92103 8.02858 3.33333 8.02858 2.61153ZM8.91193 12.512H2.53768C2.47063 12.512 2.41663 12.458 2.41663 12.3909V11.9301C2.41663 11.8631 2.47108 11.8091 2.53768 11.8091H8.91193C8.97898 11.8091 9.03298 11.8635 9.03298 11.9301V12.3909C9.03298 12.458 8.97853 12.512 8.91193 12.512ZM8.91193 9.87408H2.53768C2.47063 9.87408 2.41663 9.81963 2.41663 9.75258V9.29223C2.41663 9.22518 2.47108 9.17118 2.53768 9.17118H8.91193C8.97898 9.17118 9.03298 9.22563 9.03298 9.29223V9.75258C9.03298 9.81963 8.97853 9.87408 8.91193 9.87408ZM8.91193 7.23663H2.53768C2.47063 7.23663 2.41663 7.18218 2.41663 7.11558V6.65478C2.41663 6.58773 2.47108 6.53373 2.53768 6.53373H8.91193C8.97898 6.53373 9.03298 6.58818 9.03298 6.65478V7.11558C9.03298 7.18263 8.97853 7.23663 8.91193 7.23663Z" fill="#A3A9B6"/>
</svg>
`,
    hash: `<svg width="18" height="18" viewBox="0 0 18 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M0.666626 3.16663H7.33329V0.666626H8.99996V17.3333H7.33329V14H3.99996V11.5H7.33329V9.83329H2.33329V7.33329H7.33329V5.66663H0.666626V3.16663ZM10.6666 3.16663H13.1666V5.66663H10.6666V3.16663ZM10.6666 7.33329H14.8333V9.83329H10.6666V7.33329ZM10.6666 11.5H17.3333V14H10.6666V11.5Z" fill="#A3A9B6"/>
</svg>
`,
  };
}
